# NOC services description
---
product: "noc"
services:
  nsqlookupd:
    description: NSQ lookup daemon
    level: system
    port: 4161

  nsqd:
    description: NSQD daemon
    level: system
    port: 4151

  nsqadmin:
    description: NSQ Admin interface
    level: system
    port: 4171

  postgres:
    description: PostgreSQL server
    level: system
    port: 5432

  pgbouncer:
    description: pgbouncer daemon
    level: system
    port: 6432

  mongod:
    description: Mongod server
    level: system
    port: 27017

  influxdb:
    description: InfluxDB server
    level: system
    port: 8086

  nginx:
    description: Nginx server
    level: system
    port: 443
    require_cert: true
    required_assets:
      - web
      - card
      - bi

  grafana:
    description: Graphana server
    level: system
    port: 8002

  classifier:
    description: Classifier
    level: pool

  correlator:
    description: Correlator
    level: pool

  pmwriter:
    description: PMWriter
    level: global

  omap:
    description: OMap
    level: global

  ping:
    description: Ping
    level: pool

  syslogcollector:
    description: Syslog Collector
    level: pool

  trapcollector:
    description: SNMP Trap Collector
    level: pool

  web:
    description: Legacy web interface
    level: global
    required_assets:
      - web
      - mib

  card:
    description: Card web interface
    level: global
    required_assets:
      - card
      - web

  sae:
    description: Service activation engine
    level: global

  dev:
    description: Development node
    level: global
    required_assets:
      - mib

  notebook:
    description: Notebook
    level: global

  activator:
    description: Activator service
    level: pool

  discovery:
    description: Service and resource discovery
    level: pool

  scheduler:
    description: Scheduler and Cron
    level: global

  login:
    description: Login
    level: global

  mailsender:
    description: SMTP mail sender
    level: global

  tgsender:
    description: Telegram sender
    level: global

  memcached:
    description: Caching layer
    level: global
    port: 11211

  bi:
    description: Reports
    level: global
    required_assets:
      - bi
  mrt:
    description: MRT worker
    level: global

  grafanads:
    description: Grafana DataSource
    level: global

  escalator:
    description: Alarm escalator
    level: global

config:
  noc:
    installation_name:
      label: Installation name
      type: str
      default: Unconfigured installation

    timezone:
      label: Time Zone
      type: str
      default: Europe/Moscow

    rpc_choose_services:
      label: Choose RPC services
      type: int
      default: 3

    rpc_retry_timeout:
      label: RPC Retry timeout
      type: str
      default: 0.1,0.5,1,3,10,30

    topology_rca_window:
      label: Topology-based RCA window (seconds)
      type: int
      default: 0

    geocoding_order:
      label: List of geocoding methods
      type: str
      default: yandex,google

    geocoding_yandex_key:
      label: Yandex API key
      type: str
      default:

    geocoding_google_key:
      label: Google API key
      type: str
      default:

    geocoding_google_language:
      label: Google response language
      type: str
      default: en

    tt_escalation_limit:
      label: TT escalation limin (tt/minute)
      type: int
      default: 10

  correlator:
    max_threads:
      label: Correlator threads
      type: int
      default: 10

  pmwriter:
    batch_size:
      label: Write batch size (metrics)
      type: int
      default: 2500

    metrics_buffer:
      label: Metrics buffer size (metrics)
      type: int
      default: 50000

  classifier:
    lookup_solution:
      label: Lookup solution
      type: str
      default: noc.services.classifier.rulelookup.RuleLookup

    default_interface_profile:
      label: Default interface profile
      type: str
      default: default

  syslogcollector:
    listen_syslog:
      label: Listen SYSLOG
      type: str
      default: 0.0.0.0:514

  trapcollector:
    listen_traps:
      label: Listen SNNP Traps
      type: str
      default: 0.0.0.0:162

  sae:
    db_threads:
      label: DB threads
      type: int
      default: 4

  activator:
    script_threads:
      label: Script threads
      type: int
      default: 20

    tos:
      label: IP ToS mark
      type: int
      default: 0

  discovery:
    max_threads:
      label: Discovery threads
      type: int
      default: 10

  scheduler:
    max_threads:
      label: Scheduler threads
      type: int
      default: 10

  ping:
    tos:
      label: IP ToS mark
      type: int
      default: 0

    max_packets:
      label: Maximum number of packets to check
      type: int
      default: 3

    timeout:
      label: Ping timeout (ms)
      type: int
      default: 1000

    throttle_threshold:
      label: Amount of down objects (in percents) to enter throttling mode
      type: int
      default: 0

    restore_threshold:
      label: Amount of down objects (in percents) to leave throttling mode
      type: int
      default: 0

  card:
    language:
      label: Translation language
      type: str
      default: en

    weight:
      label: Http nginx Weight
      type: int
      default: 5

  login:
    language:
      label: Translation language
      type: str
      default: en

    weight:
      label: Http nginx Weight
      type: int
      default: 5

    methods:
      label: Authentication methods
      type: str
      default: local

    session_ttl:
      label: Session TTL (days)
      type: int
      default: 7

    radius_server:
      label: RADIUS Server
      type: str

    radius_secret:
      label: RADIUS Secret
      type: str

    pam_service:
      label: PAM Service
      type: str
      default: noc

  mailsender:
    smtp_server:
      label: SMTP server address
      type: str

    smtp_port:
      label: SMTP server port
      type: int
      default: 25

    use_tls:
      label: Use SMTP TLS
      type: bool
      default: false

    helo_hostname:
      label: SMTP HELO hostname
      type: str
      default: noc

    from_address:
      label: Email sender address
      type: str
      default: noc@example.com

    smtp_user:
      label: SMTP User
      type: str

    smtp_password:
      label: SMTP Password
      type: str

  mongod:
    mongod_journal_directory:
      type: str
      label: Mongo journal directory
      default: /var/lib/mongo/journal

    mongod_data_directory:
      type: str
      label: Mongo journal directory
      default: /var/lib/mongo/

  influxdb:
    influxdb_wal_directory:
      type: str
      label: InfluxDB Wal directory
      default: /var/lib/influxdb/wal/

    influxdb_data_directory:
      type: str
      label: InfluxDB Data directory
      default: /var/lib/influxdb/data/

  postgres:
    postgres_version:
      type: str
      label: Postgresql version
      default: 9.4
      description: <strong>There will be no automatic migration beetween versions.</strong> Valid versions are 9.4, 9.6. Use <a href=https://www.postgresql.org/docs/9.6/static/upgrading.html> docs </a> before changing that field.

    postgres_wal_directory:
      type: str
      label: Postgresql wal directory
      default: /var/lib/postgresql/9.4/main/pg_xlog
      description: Unused

    postgres_data_directory:
      type: str
      label: Postgresql data directory
      default: /var/lib/postgresql/9.4/main/
      description: Unused

    postgres_max_clients:
      type: int
      label: Postgresql max clients
      default: 300

  web:
    language:
      label: Translation language
      type: str
      default: en
    weight:
      label: Http nginx Weight
      type: int
      default: 5

  nginx:
    logging:
      label: Use JSON logging
      type: bool
      default: false

    http_redirect:
      label: Redirect http to https
      type: bool
      default: true

  nsqd:
    max_messages_in_memory:
      type: int
      label: Keep max messanges in memory
      default: 10000

  bi:
    query_threads:
      type: int
      label: Concurrent query limit per process
      default: 10

    language:
      label: Translation language
      type: str
      default: en

  mrt:
    max_concurrency:
      type: int
      label: Amount of concurrent tasks
      default: 50

  grafanads:
    db_threads:
      type: int
      label: Concurrent query limit per process
      default: 10

  escalator:
    max_threads:
      label: Escalator threads
      type: int
      default: 10

  grafana:
    password:
      type: str
      label: Grafana postgres password
      default: grafana

  pgbouncer:
    pgbouncer_max_clients:
      type: int
      label: Pgbouncer max clients
      default: 3000

  memcached:
    max_clients:
      type: int
      label: memcached max clients
      default: 1024
    max_memory:
      type: int
      label: memcached max memory
      default: 64

  tgsender:
    use_proxy:
      label: Use Proxy
      type: bool
      default: false

    token:
      label: Token
      type: str

    proxy_addres:
      label: Proxy Addres (https://ip:port) If use auth (https://us:pass@ip:port)
      type: str