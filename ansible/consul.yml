- name: Common tasks
  hosts: all
  become: no
  any_errors_fatal: false
  vars_files:
    - "vars/main.yml"
  vars:
    ansible_tags: "{{ lookup('get_tags') }}"
  roles:
    - role: pre

    - role: consul
      become: yes
      tags:
        - consul

- name: Finally
  hosts: all
  become: yes
  any_errors_fatal: true
  vars_files:
    - "vars/main.yml"
  vars:
    ansible_tags: "{{ lookup('get_tags') }}"
  roles:
    - role: post
      tags:
        - post