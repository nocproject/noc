---
- name: Nginx Ha
  hosts: svc-nginx
  any_errors_fatal: true
  vars_files:
    - "vars/main.yml"
  vars:
    ansible_tags: "{{ lookup('get_tags') }}"
  roles:
    - role: pre

    - role: keepalived
      become: yes
      when: "{{ has_svc_nginx | default(False) or consul_env}}"
      tags:
        - keepalived
    - role: post
      become: yes
      tags:
        - post