---
- name: Install Ubuntu system packages
  become: "True"
  apt:
    name: "{{ packages }}"
    state: latest
    update_cache: "True"
    cache_valid_time: "{{ apt_cache_valid_time | default (3600) }}"
  register: apt_update_result
  retries: 5
  delay: 10
  until: apt_update_result is succeeded
  vars:
    packages:
      - ca-certificates
      - unzip
      - sudo
      - curl
      - apt-transport-https
      - dbus  # to setup hostname
      - build-essential  # ub18 hasn't it usually
  environment:
    https_proxy: "{{ http_proxy }}"
    http_proxy: "{{ http_proxy }}"
  tags:
    - requirements
