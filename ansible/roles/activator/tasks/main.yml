---
- include: "os/{{ ansible_distribution }}/main.yml"

- name: Install activator python packages
  pip:
    chdir: "{{noc_root}}"
    requirements: "requirements/activator.txt"
    virtualenv: "{{noc_root}}"
  environment:
    https_proxy: "{{http_proxy}}"
    http_proxy: "{{http_proxy}}"
  tags:
    - requirements

- name: Create ssh keys directories
  file:
    path: "{{ noc_root }}/var/etc/ssh/{{ item.name }}"
    state: directory
    owner: root
    group: "{{ noc_group }}"
    mode: 0550
  with_items: "{{ noc_all_pools }}"
  tags:
    - config


- name: Install ssh keys
  copy:
    src: "{{ item }}"
    dest: "{{ noc_root }}/var/etc/ssh/{{ '/'.join(item.split('/')[-2:]) }}"
    owner: root
    group: "{{ noc_group }}"
    mode: 0440
  with_fileglob:
    - "{{ tower_ssh_keys }}/*/id_*"
  tags:
    - config
