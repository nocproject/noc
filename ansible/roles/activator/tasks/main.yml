---
- include: "os/Debian/main.yml"
  when: ansible_distribution == "Debian"

- include: "os/CentOS/main.yml"
  when: ansible_distribution == "CentOS"

- include: "os/Ubuntu/main.yml"
  when: ansible_distribution == "Ubuntu"

- name: Install python packages
  pip: >
    chdir="{{noc_root}}"
    executable="{{noc_root}}/bin/pip"
    requirements="requirements/activator.txt"
    virtualenv="{{noc_root}}"

- name: Create ssh keys directories
  file:
    path: "{{ noc_root }}/var/etc/ssh/{{ item.name }}"
    state: directory
    owner: root
    group: "{{ noc_group }}"
    mode: 0550
  with_items: "{{ noc_all_pools }}"

- name: Install ssh keys
  copy:
    src: "{{ item }}"
    dest: "{{ noc_root }}/var/etc/ssh/{{ '/'.join(item.split('/')[-2:]) }}"
    owner: root
    group: "{{ noc_group }}"
    mode: 0440
  with_fileglob:
    - "{{ tower_ssh_keys }}/*/id_*"
