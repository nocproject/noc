---
# File: defaults/main.yml - Default variables for Consul

## Core
consul_arch: "{% if 'x86_64' in ansible_architecture %}amd64{%else%}386{%endif%}"
consul_pkg: "consul_{{ consul_version }}_linux_{{ consul_arch }}.zip"
consul_zip: "consul_{{ consul_version }}_{{ansible_system | lower}}_{{ consul_arch }}.zip"
consul_zip_url: "https://releases.hashicorp.com/consul/{{ consul_version }}/{{consul_zip}}"
consul_checksum_file_url: "https://releases.hashicorp.com/consul/{{ consul_version }}/consul_{{ consul_version}}_SHA256SUMS"
consul_bin_path: "/usr/bin"
consul_node_role: client

consul_config_dir: "/etc/consul.d"
consul_data_path: "/var/consul"
consul_log_path: "/var/log/consul"
consul_pid_dir: "/var/run/consul"
consul_user: "consul"
consul_group: "bin"
consul_group_name: "all"
consul_datacenter: "dc1"
consul_domain: "consul"
consul_log_level: "INFO"
consul_syslog_enable: true
consul_bind_address: "{{ansible_host}}"
consul_dns_bind_address: "127.0.0.1"
consul_http_bind_address: "0.0.0.0"
consul_https_bind_address: "0.0.0.0"
consul_rpc_bind_address: "0.0.0.0"
consul_node_name: "{{ inventory_hostname_short }}"
consul_recursors: "{{ lookup('env','CONSUL_RECURSORS') | default('[]', true) }}"
consul_encryption_key: "{{ lookup('env','CONSUL_ENCRYPTION_KEY') | default('[]', true) }}"
consul_acl_master_token: "{{ lookup('env','CONSUL_MASTER_TOKEN') | default('[]', true) }}"
consul_acl_replication_token: "{{consul_acl_master_token}}"

## ACL
consul_acl_enable: yes
consul_acl_datacenter: "{{ consul_datacenter }}"
consul_acl_default_policy: "allow"
consul_acl_down_policy: "allow"

## TLS
consul_tls_enable: "{{ lookup('env','CONSUL_TLS_ENABLE') | default(false, true) }}"
consul_src_files: "{{ lookup('env','CONSUL_SRC_FILES') | default(role_path+'/files', true) }}"
consul_tls_dir: "{{ lookup('env','CONSUL_TLS_DIR') | default('{{consul_config_dir}}/ssl', true) }}"
consul_ca_crt: "{{ lookup('env','CONSUL_CA_CRT') | default('ca.crt', true) }}"
consul_server_crt: "{{ lookup('env','CONSUL_SERVER_CRT') | default('server.crt', true) }}"
consul_server_key: "{{ lookup('env','CONSUL_SERVER_KEY') | default('server.key', true) }}"
consul_verify_incoming: false
consul_verify_outgoing: true
consul_verify_server_hostname: false
