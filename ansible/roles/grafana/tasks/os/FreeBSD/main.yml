---
- name: Enabling Grafana
  lineinfile: dest=/etc/rc.conf regexp=^grafana2_enable= line=grafana2_enable=\"YES\"

- name: Create Grafana config
  template:
    src: grafana.ini
    dest: /usr/local/etc/grafana2.conf
  notify: restart grafana

# Do not work, becouse RC script can't handle "grafana2_conf" variable properly
#- name: Setting Grafana conf file
#  lineinfile: dest=/etc/rc.conf regexp=^grafana2_conf= line=grafana2_conf=\"{{ noc_root }}/var/etc/grafana/grafana.ini\"

- name: Install Grafana
  pkgng: name="grafana2" state=present

- name: Create /var/run/grafana2 directory
  file: path=/var/run/grafana2 state=directory owner={{grafana_user}} mode=0755

- name: Create /var/log/grafana2 directory
  file: path=/var/log/grafana2 state=directory owner={{grafana_user}} mode=0755
