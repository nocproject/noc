---
- name: Add InfluxDB GPG key
  rpm_key:
    key: https://repos.influxdata.com/influxdb.key
    state: present
  environment:
    https_proxy: "{{http_proxy}}"
    http_proxy: "{{http_proxy}}"

- name: Add InfluxDB repository
  template:
    src: os/CentOS/etc/yum.repos.d/influxdb.repo.j2
    dest: /etc/yum.repos.d/influxdb.repo

- name: Install CentOS packages
  yum:
    name: influxdb
    state: present
    update_cache: yes
  environment:
    https_proxy: "{{http_proxy}}"
    http_proxy: "{{http_proxy}}"

- name: Install influx monitoring
  template:
    src: "etc/telegraf/telegraf.d/influxdb.conf.j2"
    dest: "/etc/telegraf/telegraf.d/influxdb.conf"
  tags:
    - config