---
- name: install nsqadmin.conf init file
  template:
     src: "os/Ubuntu/etc/init/nsqadmin.conf.j2"
     dest: "/etc/init/nsqadmin.conf"
  when: "ansible_service_mgr != 'systemd'"
  notify: restart nsqadmin

- name: install nsqadmin.service file
  template:
     src: etc/systemd/nsqadmin.service
     dest: /etc/systemd/system/nsqadmin.service
  when: "ansible_service_mgr == 'systemd'"
  register: nsqadmin_service

- name: Install nsqadmin monitoring
  template:
    src: "etc/telegraf/telegraf.d/nsqadmin.conf.j2"
    dest: "/etc/telegraf/telegraf.d/nsqadmin.conf"
  notify: reload telegraf
  tags:
    - config

- name: reload systemd
  shell: systemctl daemon-reload
  when: "nsqadmin_service.changed and ansible_service_mgr == 'systemd'"
