- name: Install pgbouncer
  apt:
    name: pgbouncer
  environment:
    http_proxy: "{{http_proxy}}"
  tags:
    - requirements

- name: Create pgbouncer directories
  file:
    path: "{{ item }}"
    owner: "{{ postgres_user }}"
    mode: 0700
    state: directory
  with_items:
    - /var/log/pgbouncer/
    - /var/run/pgbouncer/

- name: Install pgbouncer limits file
  template:
    src: "etc/security/limits.d/pgbouncer_limits.conf.j2"
    dest: "/etc/security/limits.d/pgbouncer_limits.conf"
  tags:
    - config