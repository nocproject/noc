---
- name: "Install PostgreSQL"
  pkgng: name="{{item}}" state=present
  with_items:
    - postgresql93-server
    - py27-psycopg2

- name: Enabling PostgreSQL
  lineinfile: dest=/etc/rc.conf regexp=^postgresql_enable= line=postgresql_enable=\"YES\"

- name: PostgreSQL init db
  command: service postgresql initdb
  args:
    creates: "{{ postgresql_hba_path }}"

- name: Starting PostgreSQL service
  # This avoid this message:
  # pg_ctl: could not read file "/usr/local/pgsql/data/postmaster.opts"
  command: service postgresql start creates=/usr/local/pgsql/data/postmaster.opts
