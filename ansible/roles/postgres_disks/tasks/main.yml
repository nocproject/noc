- name: "Create lvm {{vg_fast_name}}"
  lvg:
    vg: "{{vg_fast_name}}"
    pvs: "{{vg_fast_device}}"
    pesize: 32
  when: vg_fast_device != vg_device

- name: set same name for vg_fast_device and vg_device
  set_fact:
    vg_fast_name: "{{vg_name}}"
  when: vg_fast_device != vg_device

- name: create wal storage
  lvol:
    vg: "{{vg_fast_name}}"
    lv: wal
    size: "{{wal_lv_size}}"

- name: format wal storage
  filesystem:
    fstype: "{{wal_fs}}"
    dev: "/dev/{{vg_name}}/wal"

- name: create wal dir
  file:
    name: "{{wal_mount_point}}"
    state: directory

- name: Mount wal storage
  mount:
    name: "{{wal_mount_point}}"
    src: "/dev/{{vg_name}}/wal"
    fstype: "{{wal_fs}}"
    state: present

- name: create postgres data storage
  lvol:
    vg: "{{vg_name}}"
    lv: postgres_data
    size: "{{postgres_data_lv_size}}"

- name: format postgres data storage
  filesystem:
    fstype: "{{postgres_data_fs}}"
    dev: "/dev/{{vg_name}}/postgres_data"

- name: create postgres_data dir
  file:
    name: "{{postgres_data_mount_point}}"
    state: directory

- name: Mount postgres data storage
  mount:
    name: "{{postgres_data_mount_point}}"
    src: "/dev/{{vg_name}}/postgres_data"
    fstype: "{{postgres_data_fs}}"
    state: present
