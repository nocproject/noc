# Pre-deployment tasks
---
- name: "Loading system-dependend settings"
  include_vars: "os/{{ ansible_distribution }}.yml"
  tags:
    - config

- name: set proxy
  set_fact:
    http_proxy: "{{ proxy }}"
  when: "proxy is defined"
  tags:
    - config


- name: "Include OS-specific tasks"
  include: "os/{{ ansible_distribution }}/main.yml"
  tags:
    - config

#- name: Display all variables/facts known for a host
#  debug: var=hostvars[inventory_hostname]

- name: Stop NOC node
  service: name="{{ noc_system_service }}" state=stopped
  failed_when: False
  changed_when: False

- name: Check if vboxsf is supported
  shell: "cat /proc/filesystems"
  register: vboxsf_support

- name: Mount cache dir
  mount:
      src: cache
      name: /root/.cache
      state: mounted
      fstype: vboxsf
  when: "'virtualbox' in ansible_virtualization_type and 'vboxsf' in vboxsf_support.stdout"
  ignore_errors: yes
