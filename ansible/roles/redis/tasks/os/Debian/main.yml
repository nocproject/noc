---
- name: Ensure redis is installed.
  apt:
    name: redis-server
    state: installed
  environment:
    http_proxy: "{{http_proxy}}"
  tags:
    - redis

- name: Create systemd dir
  file:
    path: "{{item.name}}"
    state: "directory"
    owner: "{{item.owner}}"
  with_items:
    - name: "/etc/systemd/system/redis.service.d"
      owner: root
  tags:
    - redis

- name: Override systemd defaults for redis
  template:
    src: "etc/systemd/system/redis.service.d/override.conf"
    dest: "/etc/systemd/system/redis.service.d/override.conf"
  notify: systemd daemon-reload
  tags:
    - redis

- name: enable overcommit in sysctl
  sysctl:
    name: vm.overcommit_memory
    value: 1
    state: present
    reload: yes
    ignoreerrors: yes
  tags:
    - redis
