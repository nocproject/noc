---
- name: Install and upgrade NOC
  hosts: nodes
  become: yes
  any_errors_fatal: true
  roles:
    - role: pre

    - role: node
      when: "'nodes' in group_names"
      
    - role: dev
      when: has_svc_dev or has_svc_notebook

    - role: mongod
      when: has_svc_mongod

    - role: postgres
      when: has_svc_postgres

    - role: influxdb
      when: has_svc_influxdb

    - role: migrate
      when: "'svc-mongod-master' in group_names"

    - role: web
      when: has_svc_web

    - role: notebook
      when: has_svc_notebook

    - role: nginx
      when: has_svc_nginx

    - role: omap
      when: has_svc_omap

    - role: fmwriter
      when: has_svc_fmwriter

    - role: activator
      when: has_svc_activator

    - role: classifier
      when: has_svc_classifier

    - role: correlator
      when: has_svc_correlator

    - role: syslogcollector
      when: has_svc_syslogcollector

    - role: trapcollector
      when: has_svc_trapcollector

    - role: grafana
      when: has_svc_grafana

    - role: ping
      when: has_svc_ping

    - role: sae
      when: has_svc_sae

    - role: discovery
      when: has_svc_discovery

    - role: post
