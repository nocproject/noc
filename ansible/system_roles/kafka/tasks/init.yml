---
- name: Check already format (1/2)
  stat:
    path: "{{ kafka_data_log_dirs }}/bootstrap.checkpoint"
  register: boot_result
  failed_when: false
- name: Check already format (2/2)
  stat:
    path: "{{ kafka_data_log_dirs }}/meta.properties"
  register: meta_result
  failed_when: false
- name: Create Kafka Cluster ID
  command: "{{ kafka_dir }}/bin/kafka-storage.sh random-uuid"
  register: cluster_uuid
  when: >
    (not boot_result.stat.exists)
    and
    (not meta_result.stat.exists)

- name: Format log directory
  command: "{{ kafka_home }}/bin/kafka-storage.sh format -t {{ hostvars[groups['svc-kafka-exec'][0]]['cluster_uuid']['stdout'] }} -c {{ kafka_server_conf }}"
  when: hostvars[groups['svc-kafka-exec'][0]]['cluster_uuid']['stdout'] is defined
