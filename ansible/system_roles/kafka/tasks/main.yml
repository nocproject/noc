---
- name: "Include OS-specific tasks"
  include_tasks: "os/{{ ansible_distribution }}_{{ ansible_distribution_major_version }}/main.yml"
  tags:
    - requirements
    - config

- name: Add Kafka group
  group:
    name: "{{ kafka_group }}"
    state: present
    system: "True"
  tags:
    - config

- name: Add Kafka user
  user:
    name: "{{ kafka_user }}"
    comment: "Kafka user"
    group: "{{ kafka_group }}"
    system: "True"
    shell: "/bin/false"
  tags:
    - config


- name: Download kafka
  import_tasks: install.yml

- name: Creating directories
  import_tasks: dirs.yml

- name: Creating configs
  import_tasks: config.yml

- name: Creating configs
  import_tasks: init.yml

- name: Start the kafka service
  service:
    name: kafka
    state: started
    enabled: yes

- name: Delete the kafka archive file
  file:
    path: /tmp/kafka_{{ kafka_scala_version }}-{{ kafka_version }}.tgz
    state: absent
