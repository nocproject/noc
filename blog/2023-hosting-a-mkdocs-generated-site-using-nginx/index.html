
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to host mkdocs-generated site properly
">
      
      
        <meta name="author" content="Gufo Labs">
      
      
        <link rel="canonical" href="https://getnoc.com/blog/2023-hosting-a-mkdocs-generated-site-using-nginx/">
      
      
        <link rel="prev" href="../2023-project-augeas-unifying-noc-documentation/">
      
      
        <link rel="next" href="../2023-introducing-our-revamped-telegram-group-now-in-english-and-russian/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.2.5">
    
    
      
        <title>Hosting a Mkdocs-generated Site Using Nginx - NOC</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-9JQSC5GQTM"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-9JQSC5GQTM",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-9JQSC5GQTM",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hosting-a-mkdocs-generated-site-using-nginx" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NOC" class="md-header__button md-logo" aria-label="NOC" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NOC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hosting a Mkdocs-generated Site Using Nginx
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../ru/blog/2023-hosting-a-mkdocs-generated-site-using-nginx/" hreflang="ru" class="md-select__link">
              Русский
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/gufolabs/noc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../installation-guide/" class="md-tabs__link">
          
  
  Installation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sections-overview/guides/" class="md-tabs__link">
          
  
  Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sections-overview/references/" class="md-tabs__link">
          
  
  References

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sections-overview/howto/" class="md-tabs__link">
          
  
  How-to

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../sections-overview/background/" class="md-tabs__link">
          
  
  Background

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../release-policy/" class="md-tabs__link">
          
  
  Releases

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../glossary/" class="md-tabs__link">
        
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../license/" class="md-tabs__link">
        
  
    
  
  License

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../thanks/" class="md-tabs__link">
        
  
    
  
  Thanks

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NOC" class="md-nav__button md-logo" aria-label="NOC" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    NOC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gufolabs/noc" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../installation-guide/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sections-overview/guides/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Guides
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sections-overview/references/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    References
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sections-overview/howto/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    How-to
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../sections-overview/background/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Background
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../archive/2025/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Archive
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../category/news/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Categories
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../release-policy/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Releases
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../thanks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Thanks
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#checking-mkdocsyml" class="md-nav__link">
    Checking mkdocs.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dns-setup" class="md-nav__link">
    DNS Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx-configuration" class="md-nav__link">
    Nginx Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-setup" class="md-nav__link">
    HTTP Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#certbot-setup" class="md-nav__link">
    Certbot Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#https-setup" class="md-nav__link">
    HTTPS Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-robotstxt" class="md-nav__link">
    Adding robots.txt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#results" class="md-nav__link">
    Results
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://secure.gravatar.com/avatar/46438b1a87fd8a5f9627454c7a42593e?s=80&d=identicon" alt="Dmitry Volodin">
                    </span>
                    <span class="md-profile__description">
                      <strong>Dmitry Volodin</strong><br>
                      Project Leader
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__title">
                <div class="md-nav__link">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
              </li>
              <li class="md-nav__item">
                <div class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                  <time datetime="2023-10-11 00:00:00" class="md-ellipsis">October 11, 2023</time>
                </div>
              </li>
              
              
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                    <span class="md-ellipsis">
                      in
                      
                        <a href="../category/tech/">Tech</a></span>
                  </div>
                </li>
              
              
                
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                    <span class="md-ellipsis">
                      
                        9 min read
                      
                    </span>
                  </div>
                </li>
              
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        

  
    <a href="https://github.com/gufolabs/noc/-/edit/master/docs/blog/posts/nginx-serving-mkdocs-site/index.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="hosting-a-mkdocs-generated-site-using-nginx">Hosting a Mkdocs-generated Site Using Nginx<a class="headerlink" href="#hosting-a-mkdocs-generated-site-using-nginx" title="Permanent link">&para;</a></h1>
<p>Creating exceptional software documentation is a pivotal ingredient for product success. The NOC Team has been on a relentless journey with <a href="../2023-project-augeas-unifying-noc-documentation/">Project Aegeus</a> to make our documentation truly shine. While top-notch content is essential, the delivery process plays a crucial role in shaping the user experience. In this post, we're shifting our focus to delivery, where we'll reveal some tricks that can take your documentation from good to great.</p>
<p>Mkdocs, especially when adorned with the stylish mkdocs-material theme, is an outstanding tool for crafting project documentation. The outcome is a directory brimming with polished HTML files and static assets. Unlike popular CMS platforms like Joomla or WordPress, your output is a self-contained directory that doesn't rely on additional runtime services or databases. This independence makes it incredibly easy to serve your documentation directly to your audience. While services like "GitHub Pages" and "Read the Docs" have their allure, there's a compelling case for hosting your documentation independently. We, for instance, rely on the rock-solid Nginx web server. In the following sections, we'll offer you a glimpse into our setup and share some simple yet highly effective tweaks to enhance performance.</p>
<!-- more -->

<p>Let's take a glance at our setup. Here and after we consider that <code>&lt;site&gt;</code> should
be replaced with your domain name. We also consider you have Nginx installed and running.</p>
<h2 id="checking-mkdocsyml">Checking mkdocs.yml<a class="headerlink" href="#checking-mkdocsyml" title="Permanent link">&para;</a></h2>
<p>Check the <code>mkdocs.yml</code> file and ensure, your <code>site_url</code> setting is valid:</p>
<div class="highlight"><pre><span></span><code><span class="nt">site_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://&lt;site&gt;/</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>https://</code> prefix is viable for our setup.</p>
</div>
<h2 id="dns-setup">DNS Setup<a class="headerlink" href="#dns-setup" title="Permanent link">&para;</a></h2>
<p>Add <code>A</code> record to your DNS Zone to reach your site</p>
<div class="highlight"><pre><span></span><code>@   IN  A  &lt;ip&gt;
</code></pre></div>
<p>Where <code>&lt;ip&gt;</code> is the IP address of your Nginx server.</p>
<h2 id="nginx-configuration">Nginx Configuration<a class="headerlink" href="#nginx-configuration" title="Permanent link">&para;</a></h2>
<p>Let's take a closer look at our configuration. We are creating two virtual servers, one for HTTP on port 80, and the other for HTTPS on port 443. Each virtual server has its configuration
file. I.e. <code>&lt;site&gt;:80.conf</code> and <code>&lt;site&gt;:443.conf</code>, though you can use every other name to your pleasure.</p>
<h2 id="http-setup">HTTP Setup<a class="headerlink" href="#http-setup" title="Permanent link">&para;</a></h2>
<p>Create a first configuration file, named <code>&lt;site&gt;:80.conf</code>, replacing <code>&lt;site&gt;</code> with your domain name.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:80.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 80;
    server_name &lt;site&gt;;

    access_log  /var/log/nginx/&lt;site&gt;:80.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:80.error.log;

    location ^~ /.well-known/acme-challenge/ {
       default_type &quot;text/plain&quot;;
       root /data/letsencrypt/&lt;site&gt;;
    }

    location / {
        return 301 https://&lt;site&gt;$request_uri;
    }
}
</code></pre></div></td></tr></table></div>
<p>Place it into one of the following paths, depending on your system:</p>
<ul>
<li><code>/etc/nginx/conf.d/&lt;site&gt;.conf</code></li>
<li><code>/etc/nginx/sites-available/&lt;site&gt;.conf</code></li>
</ul>
<p>If you choose to place config in the <code>sites-available</code> directory, do not
forget to create a symlink to enable config:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># cd /etc/nginx/sites-enabled/</span>
<span class="c1"># ln -s /etc/nginx/sites-available/&lt;site&gt;:80.conf .</span>
</code></pre></div>
<p>Then check the configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># nginx -T</span>
...
<span class="c1"># echo $?</span>
<span class="m">0</span>
</code></pre></div>
<p>If you do all correctly, the command will complete without errors and you will
see <code>0</code> as a result of the <code>echo</code>.</p>
<p>Reload configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># service nginx reload</span>
</code></pre></div>
<p>Let's examine the configuration:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:80.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
<span class="hll">    listen 80;
</span><span class="hll">    server_name &lt;site&gt;;
</span>
    access_log  /var/log/nginx/&lt;site&gt;:80.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:80.error.log;

    location ^~ /.well-known/acme-challenge/ {
       default_type &quot;text/plain&quot;;
       root /data/letsencrypt/&lt;site&gt;;
    }

    location / {
        return 301 https://&lt;site&gt;$request_uri;
    }
}
</code></pre></div></td></tr></table></div>
<p>Listen for virtual site <code>&lt;site&gt;</code> on default HTTP port 80.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:80.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 80;
    server_name &lt;site&gt;;

<span class="hll">    access_log  /var/log/nginx/&lt;site&gt;:80.access.log;
</span><span class="hll">    error_log  /var/log/nginx/&lt;site&gt;:80.error.log;
</span>
    location ^~ /.well-known/acme-challenge/ {
       default_type &quot;text/plain&quot;;
       root /data/letsencrypt/&lt;site&gt;;
    }

    location / {
        return 301 https://&lt;site&gt;$request_uri;
    }
}
</code></pre></div></td></tr></table></div>
<p>Set up logging.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:80.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 80;
    server_name &lt;site&gt;;

    access_log  /var/log/nginx/&lt;site&gt;:80.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:80.error.log;

<span class="hll">    location ^~ /.well-known/acme-challenge/ {
</span><span class="hll">       default_type &quot;text/plain&quot;;
</span><span class="hll">       root /data/letsencrypt/&lt;site&gt;;
</span><span class="hll">    }
</span>
    location / {
        return 301 https://&lt;site&gt;$request_uri;
    }
}
</code></pre></div></td></tr></table></div>
<p>We using Certbot to obtain TLS certificates from Letsencrypt.
We're creating a well-known entrypoint to process a
certificate request.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:80.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 80;
    server_name &lt;site&gt;;

    access_log  /var/log/nginx/&lt;site&gt;:80.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:80.error.log;

    location ^~ /.well-known/acme-challenge/ {
       default_type &quot;text/plain&quot;;
       root /data/letsencrypt/&lt;site&gt;;
    }

<span class="hll">    location / {
</span><span class="hll">        return 301 https://&lt;site&gt;$request_uri;
</span><span class="hll">    }
</span>}
</code></pre></div></td></tr></table></div>
<p>We forcing our users to use HTTPS, redirecting all other requests
to the HTTPS version of the site.</p>
<h2 id="certbot-setup">Certbot Setup<a class="headerlink" href="#certbot-setup" title="Permanent link">&para;</a></h2>
<p>Before passing to the HTTPS section we need to receive a TLS certificate.
We're using Certbot to request certificates via Letsencrypt.</p>
<p>To request the certificate:</p>
<div class="highlight"><pre><span></span><code># certbot --nginx -d &lt;site&gt;
</code></pre></div>
<p>Check that our certificates are present in place:</p>
<div class="highlight"><pre><span></span><code># ls /etc/letsencrypt/live/&lt;site&gt;/
fullchain.pem
privkey.pem
</code></pre></div>
<h2 id="https-setup">HTTPS Setup<a class="headerlink" href="#https-setup" title="Permanent link">&para;</a></h2>
<p>If all is correct, create a file named <code>&lt;site&gt;:443.conf</code>, replacing <code>&lt;site&gt;</code> with your domain name.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;

    root /www/&lt;site&gt;;
    error_page 404 /404.html;

    add_header X-Content-Type-Options nosniff;

    gzip on;
    gzip_types text/html application/javascript text/css text/xml application/json;

    location ~* .min.(css|js)$ {
        add_header Cache-Control &quot;max-age=604800&quot;;
        add_header Surrogate-Control &quot;max-age=604800&quot;;
    }

   location /search/search_index.json {
        add_header Cache-Control &quot;max-age=3600&quot;;
        add_header Surrogate-Control &quot;max-age=3600&quot;;
   }

    location /.minio.sys/ {
        deny all;
    }
}
</code></pre></div></td></tr></table></div>
<p>Place it into one of the following paths, depending on your system:</p>
<ul>
<li><code>/etc/nginx/conf.d/&lt;site&gt;.conf</code></li>
<li><code>/etc/nginx/sites-available/&lt;site&gt;.conf</code></li>
</ul>
<p>If you choose to place config in the <code>sites-available</code> directory, do not
forget to create a symlink to enable config:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># cd /etc/nginx/sites-enabled/</span>
<span class="c1"># ln -s /etc/nginx/sites-available/&lt;site&gt;:443.conf .</span>
</code></pre></div>
<p>Then check the configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># nginx -T</span>
...
<span class="c1"># echo $?</span>
<span class="m">0</span>
</code></pre></div>
<p>If you do all correctly, the command will complete without errors and you will
see <code>0</code> as a result of the <code>echo</code>.</p>
<p>Reload configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># service nginx reload</span>
</code></pre></div>
<p>Let's examine the configuration:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll">server {
</span><span class="hll">    listen 443 ssl http2;
</span>    server_name &lt;site&gt;;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
<p>Listen for virtual site <code>&lt;site&gt;</code> on default HTTPЫ port 443
and enable HTTP/2.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;
<span class="hll">
</span>    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
Enable TLSv1.3 and TLSv1.2, do not use older versions.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;

<span class="hll">    ssl_protocols TLSv1.3 TLSv1.2;
</span><span class="hll">    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
</span>    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
Use TLS certificates, prepared by Certbot.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
<span class="hll">    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
</span>    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
Always set <code>Strict-Transport-Security</code> header to enable HSTS.
The HSTS informs browsers that the site should only be accessed using HTTPS and that any future attempts to access it using HTTP should automatically be converted to HTTPS.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
<span class="hll">    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
</span><span class="hll">    ssl_stapling on;
</span>    ssl_stapling_verify on;

    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
Enable Online Certificate Status Protocol (OSCP) stapling to check
the revocation status of the certificates in an efficient manner.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>server {
    listen 443 ssl http2;
    server_name &lt;site&gt;;

    ssl_protocols TLSv1.3 TLSv1.2;
    ssl_certificate /etc/letsencrypt/live/&lt;site&gt;/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/&lt;site&gt;/privkey.pem; # managed by Certbot
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains&quot;;
    ssl_stapling on;
    ssl_stapling_verify on;
<span class="hll">
</span><span class="hll">    access_log  /var/log/nginx/&lt;site&gt;:443.access.log;
</span>    error_log  /var/log/nginx/&lt;site&gt;:443.error.log;
</code></pre></div></td></tr></table></div>
<p>Set up logging.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll">    root /www/&lt;site&gt;;
</span>    error_page 404 /404.html;

    add_header X-Content-Type-Options nosniff;

    gzip on;
    gzip_types text/html application/javascript text/css text/xml application/json;
</code></pre></div></td></tr></table></div>
Serve static files from <code>/www/&lt;site&gt;/</code> directory. We use Minio's
S3 endpoint to deliver our documentation, though you can simple
put your files in place using any available method.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>    root /www/&lt;site&gt;;
<span class="hll">    error_page 404 /404.html;
</span>
    add_header X-Content-Type-Options nosniff;

    gzip on;
    gzip_types text/html application/javascript text/css text/xml application/json;
</code></pre></div></td></tr></table></div>
<p>To enhance the user experience, replace Nginx's default 404 page with the stylish page provided by mkdocs-material. This step is crucial as the customized page offers standard navigation and search functionalities, enabling users to easily access all the information they need.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>    root /www/&lt;site&gt;;
    error_page 404 /404.html;

<span class="hll">    add_header X-Content-Type-Options nosniff;
</span>
    gzip on;
    gzip_types text/html application/javascript text/css text/xml application/json;
</code></pre></div></td></tr></table></div>
Configure the X-Content-Type-Options header for all responses to specify that the advertised MIME types in the Content-Type headers should be strictly followed and not altered. This header helps prevent MIME type sniffing by explicitly stating that the MIME types are intentionally set and should not be modified.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>    root /www/&lt;site&gt;;
    error_page 404 /404.html;

    add_header X-Content-Type-Options nosniff;

<span class="hll">    gzip on;
</span><span class="hll">    gzip_types text/html application/javascript text/css text/xml application/json;
</span></code></pre></div></td></tr></table></div>
Activate gzip compression for all web browsers. This feature will automatically compress HTML, CSS, JSON, and XML files for all modern browsers. Data compression plays a vital role in reducing network traffic, offering substantial advantages to mobile users, and boosting page loading speed. We have fine-tuned the compression settings to work seamlessly with content generated by mkdocs-material, ensuring an optimized user experience.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll">    location ~* .min.(css|js)$ {
</span><span class="hll">        add_header Cache-Control &quot;max-age=604800&quot;;
</span><span class="hll">        add_header Surrogate-Control &quot;max-age=604800&quot;;
</span><span class="hll">    }
</span>
   location /search/search_index.json {
        add_header Cache-Control &quot;max-age=3600&quot;;
        add_header Surrogate-Control &quot;max-age=3600&quot;;
   }

    location /.minio.sys/ {
        deny all;
    }
}
</code></pre></div></td></tr></table></div>
<p>For even more efficient file serving, we've implemented some additional optimizations, specifically targeting the minified CSS and JS content generated by the mkdocs-material theme. To improve caching efficiency, mkdocs-material appends a unique hash to the file names.</p>
<p>Here's what we've done:</p>
<ul>
<li><code>Cache-Control`` Header: We've configured the</code>Cache-Control`` header to instruct the browser to store these minified files for a week, reducing the need for additional requests as users navigate through our documentation.</li>
<li><code>Surrogate-Control</code> Header: We've added the <code>Surrogate-Control</code> header to notify upstream CDNs (Content Delivery Networks) to cache these replies whenever possible.</li>
</ul>
<p>Efficient file caching is yet another step we've taken to enhance the user experience, ensuring that your documentation loads swiftly and reliably.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code>    location ~* .min.(css|js)$ {
        add_header Cache-Control &quot;max-age=604800&quot;;
        add_header Surrogate-Control &quot;max-age=604800&quot;;
    }

<span class="hll">   location /search/search_index.json {
</span><span class="hll">        add_header Cache-Control &quot;max-age=3600&quot;;
</span><span class="hll">        add_header Surrogate-Control &quot;max-age=3600&quot;;
</span><span class="hll">   }
</span>
    location /.minio.sys/ {
        deny all;
    }
}
</code></pre></div></td></tr></table></div>
Mkdocs-material maintains a database for online search, stored in the search_index.json file. For complex documentation, like NOC's, this JSON file can become quite large, roughly around 4 megabytes. Since we frequently update our content, long-term caching isn't practical. Therefore, we've established a reasonable default of one hour for caching this file.</p>
<p>Just like with minified files, we've configured the Cache-Control and Surrogate-Control options for the search_index.json file. These settings help optimize the caching of this file, ensuring that users can perform online searches effectively without compromising the freshness of the data.</p>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">site:443.conf</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code>    location ~* .min.(css|js)$ {
        add_header Cache-Control &quot;max-age=604800&quot;;
        add_header Surrogate-Control &quot;max-age=604800&quot;;
    }

   location /search/search_index.json {
        add_header Cache-Control &quot;max-age=3600&quot;;
        add_header Surrogate-Control &quot;max-age=3600&quot;;
   }

<span class="hll">    location /.minio.sys/ {
</span><span class="hll">        deny all;
</span><span class="hll">    }
</span>}
</code></pre></div></td></tr></table></div>
Since we're utilizing Minio for content uploads, it's crucial to safeguard Minio's internal database from accidental exposure. To achieve this, we take the straightforward approach of denying access to the internal directory. This ensures that the inner workings of Minio remain protected and inaccessible to unauthorized parties.</p>
<h2 id="adding-robotstxt">Adding robots.txt<a class="headerlink" href="#adding-robotstxt" title="Permanent link">&para;</a></h2>
<p>Last but not least, we want to simplify the lives of search engine bots. You can achieve this by simply including a robots.txt file in your docs/ directory to ensure it's generated alongside your documentation. Don't forget to replace <code>&lt;site&gt;</code> with your domain name in the file. This step ensures that search engine crawlers can efficiently navigate and index your content, contributing to its discoverability on the web.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">robots.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>User-agent: *
Allow: /

Sitemap: https://&lt;site&gt;/sitemap.xml
</code></pre></div></td></tr></table></div>
<p>Let's look closer:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">robots.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="hll">User-agent: *
</span><span class="hll">Allow: /
</span>
Sitemap: https://&lt;site&gt;/sitemap.xml
</code></pre></div></td></tr></table></div>
<p>Allow all bots to index our documentation.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">robots.txt</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>User-agent: *
Allow: /

<span class="hll">Sitemap: https://&lt;site&gt;/sitemap.xml
</span></code></pre></div></td></tr></table></div>
<p>Let's also inform search engine bots that we have a sleek sitemap generated by mkdocs-material. This will help the bots efficiently crawl and index our content, making it more discoverable on the web.</p>
<h2 id="results">Results<a class="headerlink" href="#results" title="Permanent link">&para;</a></h2>
<p>We utilized Google Chrome's Lighthouse tool to evaluate the user experience of our home page, https://getnoc.com/.</p>
<p>Before implementing the changes and using the standard boilerplate for serving static files, we had an overall performance score of 75.</p>
<p>However, after applying all the tweaks we've discussed in this post, we significantly improved our performance, achieving an outstanding overall score of 97.</p>
<p><img alt="Lighthouse screenshot" src="../nginx-serving-mkdocs-site/lighthouse.png" /></p>
<p>These methods are not limited to our use case; anyone looking to host mkdocs-material sites with only the default set of Nginx features can benefit from them. We hope that our insights and experience will help you enhance the user experience of your documentation.</p>
<p><a href="https://github.com/gufolabs/noc/discussions/15">Comments...</a></p>


  


  



      
    </article>
  </div>

          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../2023-project-augeas-unifying-noc-documentation/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Project Augeas: Unifying NOC Documentation" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Project Augeas: Unifying NOC Documentation
              </div>
            </div>
          </a>
        
        
          
          <a href="../2023-introducing-our-revamped-telegram-group-now-in-english-and-russian/" class="md-footer__link md-footer__link--next" aria-label="Next: Introducing Our Revamped Telegram Group: Now in English and Russian!" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Introducing Our Revamped Telegram Group: Now in English and Russian!
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2007-2025, Gufo Labs
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "navigation.tabs", "navigation.tabs.sticky", "navigation.prune", "navigation.footer"], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "24.1"}</script>
    
    
      <script src="../../assets/javascripts/bundle.78eede0e.min.js"></script>
      
    
  </body>
</html>