# Учет и управление BGP сессиями:

Модуль `Peering Management` позволяет вести учет:  

  - RPSL объектов и историю их изменений  
  - BGP сессий
  - Автоматически или полу-автоматически подготавливать и выгружать актуальные данные в базу RIR
  - Построение префикс листов на основе внесенных данных  
  - Уведомление о изменении списка IP сетей анонсиремых клиентами  
  - Позволяет заполнить дополнительной информацией карточку аварии при классификации события BGP.

<!-- prettier-ignore -->
!!! info ""

    Если нужен только учет BGP сессий, то настройку можно начинать с раздела ["Настройка основных параметров"](#настройка-основных-параметров)

## Порядок настройки модуля  

Предварительная настройка - почти все поля соответствуют таковым в **RIPE DB**, обязательные поля подсвеченны красным, если каких-то полей не хватает, то эти параметры можно указать в поле `Extra`.   

1.  **Управление ПИРами** - **Настройки** - **Persons**: 
 
    - Добавляем все необходимые объекты с типом **Persons** 
    - Добавляем все необходимые объекты с типом **Role** (noc, abuse, tech, и т.п)  

2.  **Управление ПИРами** - **Настройки** - **Ответственный**: 

    - Добавляем Mainteiner`а(ов)  

3.  **Управление ПИРами** - **Настройки** - **Организации**:  

    - Добавляем свою органихацию(и). В поле `Org. Type` указываем  `LIR`, если она является лиром. Для всех остальных - `Other`.  

4.  **Управление ПИРами** - **Настройки** - **Профили AS**:

    - Создаем необходимое кол-во профилей с разными цветами, которыми потом ASN будут  помеченны в списке. Например для визуального разделения различных подведомственных организаций, и т.п.  


## Настройка основных параметров  
    
1.  **Управление ПИРами** - **Настройки** - **Группы пиров**: 

    - Создаем все необходимые группы, на которые будем разделять наши сессии, например `left`(uplinks), `right`(downlinks), и т.п. Тут же можо указать основные параметры влияющие на приоритет маршрутов, которые действуют на всю группу. 

1.  **Управление ПИРами** - **ASes**  

    - Добавляем сюда все свои автономные системы, с которыми будем работать. После добавления, изменения, удаления сессий с данными AS в **Управление ПИРами**  - **Пиры**, можно сгенерировать описание для этого обекта(AS) в  RIPEDB. Для этого необходимо пересохранить нужную AS и нажать на значок с изображением лупы.  

1.  **Управление ПИРами** - **Настройки** - **Peering Points**: 

    - Добавляем все роутеры на которых у нас будут BGP сесии(для которых нужно вести учет). Галочка `Enable Prefix-List Provisioning` отвечает за включение функции периодического запроса префиксов по всем внесенным сессиям из базы RIR, если обнаруженны изменения - отправляет уведомление в группу `Prefix-List Notification Group`. В поле `Location` при желании указывается физическое расположение. Если профиля под используеммый маршрутизатор нет, то выбираем `Generic`. 
    
1.  **Управление ПИРами** - **Communities** и **Наборы AS**:
      
    - Добавляем все свои комьюнити и as-set, которые планируем использовать.  

## Добавление BGP сессий

Раздел **Управление ПИРами** - **Пиры**, добавить новую запись с обязательным заполнением следующих полей:  

  - **Peering Point**  - оборудование, на котором будет создана сессия  
  - **Peer Group**  - группа(тип: Клиенты, Поставщики, и т.д) сессии  
  - **Проект**  - номер договора  
  - **Локальная AS** - номер автономной системы с нашей стороны  
  - **Remote AS**  - номер автономной системы со стороны клиента, поставщика, или др.  
  - **Статус**  - планируеммое состаяние, например активная, запланированно включение, деактивированна  
  - **Локальный IP**  - ip на нашей стороне, обязательно ^^указывать с маской сети!^^(с которой он прописан на интерефейсе оборудования)  
  - **Remote IP**  - ip на противоположной стороне, обязательно ^^указывать с маской сети!^^(с которой он прописан на интерефейсе оборудования)  
  - **Описание**  - можно указать краткое наименование организации с которой настраивается сессия. Данное поле в дальнейшем может использоваться в шаблонах текста аварий.  
  - **RPSL Remark**  - краткое наименование организации в нижнем регистре с использованием только латинских букв, цифр и символов тире(**-**) или нижнего подчеркивания(**\_**). Это поле используется для комментария в RPSL описании ASN, так же может использоваться в названии каких-либо объектов при настройке на оборудовании через персональные скрипты или сниппеты.  
  - **Import Filter**  - AS-SET или номер автономной системы (напр. `AS12345`), которые клиент указал в заказе для формирования списка его сетей. Если сессия настраивается не для клиента, то указывается имя policy-statement, которое будет использованно в этой сессии.  
  - **Export Filter**  - имя фильтра для исходящих анонсов или AS-SET, на основе которого противоположная сторона будет строить свои фильтры.
  - **Import Communities**  - указываются через _пробел_ комьюнити для управления трафиком. Например `RTK-3P`(если роутер поддреживает в текстовом виде) или `65535:666`. 
