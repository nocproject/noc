#!./bin/python
# -*- coding: utf-8 -*-
##----------------------------------------------------------------------
## System Version Report
##----------------------------------------------------------------------
## Copyright (C) 2007-2011 The NOC Project
## See LICENSE for details
##----------------------------------------------------------------------

## NOC modules
import settings
from noc.lib.version import (get_version, get_branch, get_os_brand,
                             get_os_version, get_mongo_version,
                             get_pg_version, get_python_version,
                             get_python_packages, get_solutions)
from noc.lib.debug import error_report


def get_system_uuid():
    from noc.support.cp import CPClient
    c = CPClient()
    return c.system_uuid


def about():
    sid = get_system_uuid()
    versions = [
        ["NOC", get_version()],
        ["System ID", sid if sid else "Not registred"],
        ["Branch", get_branch()],
        ["OS", get_os_version()]
    ]
    os_brand = get_os_brand()
    if os_brand:
        versions += [["OS Brand", os_brand]]
    versions += [
        ["Python", get_python_version()],
        ["PostgreSQL", get_pg_version()],
        ["MongoDB", get_mongo_version()]
    ]
    versions += [["Solutions", ""]]
    versions += [["", sn[0]] for sn in get_solutions()]
    pp = get_python_packages()
    versions += [["Python packages", ""]]
    versions +=[(p, pp[p]) for p in sorted(pp)]
    for c, v in versions:
        print "|%s|%s|" % (c, v.replace("\n", " "))

if __name__ == "__main__":
    try:
        about()
    except:
        error_report(reverse=True)
