#!/bin/sh
# ----------------------------------------------------------------------
# Build UI bundle
# ----------------------------------------------------------------------
# Copyright (C) 2007-2025 The NOC Project
# See LICENSE for details
# ----------------------------------------------------------------------
set -e -x

CDN=https://cdn.getnoc.com/npkg
PKGS="
extjs@6.0.1
bootstrap@3.3.7
joint@2.1.2
joint.layout.directedgraph@2.1.2
dagre@0.7.4
graphlib@1.0.7
jquery@3.1.1
jquery.tablesorter@1.0.0
jquery.table2csv@1.0.0
lodash@3.10.1
backbone@1.3.3
fontawesome@4.7.0
fontawesome7@7.0.0
nocsound@1.0.0
handlebars@4.0.5
pdfmake@0.1.71
noc-stencils-cisco@1.0.5
noc-stencils-juniper@1.0.1
noc-stencils-flaticon@1.0.1
jquery.tokeninput@1.1.1
django-media@3.1.8
viz-js@3.7.0
leaflet@1.9.4
theme-noc@1.5.21
"

for pkg in $PKGS; do
    name=$(echo "$pkg" | cut -d'@' -f1)
    version=$(echo "$pkg" | cut -d'@' -f2-)
    curl -L "$CDN/$name%40$version.tar.bz2" | tar jxfv -
done

cd ui/
npm install
npm run build:micromark
npm run build:monaco
npm run vendor
npm run prod
